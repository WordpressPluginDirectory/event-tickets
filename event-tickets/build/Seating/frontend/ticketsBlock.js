(()=>{"use strict";var e,t={"0zfD":(e,t,n)=>{n.d(t,{ajaxNonce:()=>s,ajaxUrl:()=>o});const a=window?.tec?.tickets?.seating?.ajaxData,{ajaxUrl:o,ajaxNonce:s,ACTION_GET_SEAT_TYPES_BY_LAYOUT_ID:i,ACTION_INVALIDATE_MAPS_LAYOUTS_CACHE:c,ACTION_INVALIDATE_LAYOUTS_CACHE:r,ACTION_DELETE_MAP:l,ACTION_DELETE_LAYOUT:d,ACTION_ADD_NEW_LAYOUT:u,ACTION_DUPLICATE_LAYOUT:_,ACTION_POST_RESERVATIONS:m,ACTION_CLEAR_RESERVATIONS:f,ACTION_FETCH_ATTENDEES:p,ACTION_DELETE_RESERVATIONS:k,ACTION_SEAT_TYPES_UPDATED:g,ACTION_SEAT_TYPE_DELETED:y,ACTION_RESERVATIONS_UPDATED_FROM_SEAT_TYPES:h,ACTION_RESERVATION_CREATED:w,ACTION_RESERVATION_UPDATED:T,ACTION_EVENT_LAYOUT_UPDATED:v,ACTION_REMOVE_EVENT_LAYOUT:E}=a},Gn6f:(e,t,n)=>{n.d(t,{formatWithCurrency:()=>r});const{decimalSeparator:a,decimalNumbers:o,thousandSeparator:s,position:i,symbol:c}=window.tec.tickets.seating.currencyData;function r(e){const[t,n]=e.toString().split("."),r=n?"."+Number("."+n).toPrecision(o).toString().slice(2):"",l=t.toString().replace(/\./g,a).replace(/\B(?=(\d{3})+(?!\d))/g,s)+r;return"prefix"===i?`${c}${l}`:`${l}${c}`}},"Lc+o":(e,t,n)=>{function a(e,t){const n=e.replace(/{(\w*)}/g,(function(e,n){return t?.[n]||""})),a=document.createElement("template");return a.innerHTML=n.trim(),a.content.children[0]}n.d(t,{createHtmlComponentFromTemplateString:()=>a})},QiLJ:(e,t,n)=>{n.r(t),n.d(t,{addModalEventListeners:()=>le,bootstrapIframe:()=>oe,cancelReservations:()=>se,closeModal:()=>ie,setExpireDate:()=>re});const a=window.tec.tickets.seating.serviceData,o=a.baseUrl.replace(/\/$/,""),s=a.mapsHomeUrl.replace(/\/$/,""),i=a.layoutsHomeUrl.replace(/\/$/,"");function c(){return o.split("?")[0]}a.associatedEventsUrl.replace(/\/$/,"");const r="app_postmessage_ready",l="app_postmessage_ready_for_data",d="host_postmessage_ready",u="host_postmessage_seat_type_tickets",_="app_postmessage_seats_selected",m="app_postmessage_map_created_updated",f="app_postmessage_layout_created_updated",p="app_postmessage_seat_type_created_updated",k="app_postmessage_goto_maps_home",g="app_postmessage_goto_layouts_home",y="host_postmessage_remove_reservations";var h=n("0zfD");function w(e){console.debug("Message received from service",e)}async function T(){const e=new URL(h.ajaxUrl);return e.searchParams.set("_ajax_nonce",h.ajaxNonce),e.searchParams.set("action","tec_tickets_seating_service_invalidate_layouts_cache"),200===(await fetch(e.toString(),{method:"POST"})).status||(console.error("Invalidation of layouts cache failed, clean the transients manually to fetch up-to-date layouts from the service."),!1)}const v={ready:!1,establishingReadiness:!1,actionsMap:{default:w,[m]:function(){!async function(){const e=new URL(h.ajaxUrl);e.searchParams.set("_ajax_nonce",h.ajaxNonce),e.searchParams.set("action","tec_tickets_seating_service_invalidate_maps_layouts_cache"),200===(await fetch(e.toString(),{method:"POST"})).status||console.error("Invalidation of maps and layouts cache failed, clean the transients manually to fetch up-to-date maps and layouts from the service.")}()},[f]:function(){T()},[p]:function(){T()},[k]:function(){s?window.location.href=s:console.error("Maps home url not found")},[g]:function(){i?window.location.href=i:console.error("Layouts home url not found")}},token:null};function E(e,t){v.actionsMap[e]=t}function b(e){delete v.actionsMap[e]}function S(){return v.token}let A=[];function I(e,t,n){const a=e.closest("[data-token]").dataset.token;a?e.contentWindow.postMessage({action:t,token:a,data:n||null},c()):console.error("No token found in iframe element")}function O(){if(0===A.length)return;const[e,t,n]=A[0],a=function(e){return async t=>{await e(t),A.shift(),O()}}(t);a(n.data.data)}function N(e){if(e.origin!==c()||!e.data.token||e.data.token!==S())return;const t=e.data.action;if(!t)return void console.error("No action found in message");const n=function(e){return v.actionsMap[e]||v.actionsMap.default||w}(t);A.push([t,n,e]),A.length>1||O()}async function L(e){let t;!function(e){const t=e.closest("[data-token]");if(!t)return void console.error("No token provider found in iframe element");const n=t.dataset.token;n?(function(e){v.token=e}(n),window.addEventListener("message",N)):console.error("No token found in token provider element")}(e);const n=new Promise(((n,o)=>{t=o,E(r,(()=>{b(r),v.ready=true,v.establishingReadiness=false,I(e,d),clearTimeout(a),console.debug("Readiness established."),n()}))})),a=setTimeout((()=>{t(new Error("Connection to service timed out"))}),3e3);return e.src=e.dataset.src,n}const{_x}=wp.i18n;async function C(e){if(!e)return!1;const t=e.closest(".tec-tickets-seating__iframe-container");if(!t)return!1;if(!t.dataset.token){const e=_x("Ephemeral token not found in iframe element.","Error message","event-tickets");return function(e){const t=document.getElementById("tec-tickets-seating-notice");(function(e){e&&(e.style.display="none",e.style.visibility="hidden")})(t),function(e,t){if(!e)return;const n=e.classList;n.remove("notice-success"),n.remove("notice-warning"),n.remove("notice-error"),n.add(t)}(t,"notice-error"),function(e,t){e&&(e.innerHTML="<p>"+t+"</p>")}(t,e),function(e){e&&(e.style.display="block",e.style.visibility="visible")}(t)}(t.dataset.error||e),!1}return await L(e),!0}var P=n("Lc+o");const x=window?.tec?.tickets?.seating?.frontend?.ticketsBlockData;var D=n("Gn6f");const R=window.wp.hooks,U=tec.tickets.seating.frontend.session;async function j(e){const t=new URLSearchParams(window.location.search);t.append("tec-tc-cart","redirect");const n=`${window.location.origin}${window.location.pathname}?${t}`,a=await fetch(n,{method:"POST",body:e});return!(!a.ok||!a.url||((0,U.setIsInterruptable)(!1),window.location.href=a.url,0))}const q=Object.values(x.seatTypeMap).reduce(((e,t)=>(e.push(...t.tickets.map((e=>e.ticketId))),e)),[]);(0,R.addFilter)("tec.tickets.tickets-block.getTickets","tec.tickets.seating",(function(){return q}));const{objectName:M,seatTypeMap:H,labels:V,providerClass:Y,postId:$,ajaxUrl:F,ajaxNonce:B,ACTION_POST_RESERVATIONS:W,ACTION_CLEAR_RESERVATIONS:J,sessionTimeout:G}=x;let z=null,Q=null,K=null;const X=".tec-tickets-seating__modal .tec-tickets-seating__sidebar-control--confirm",Z=Object.values(H).reduce(((e,t)=>(t.tickets.forEach((t=>{e[t.ticketId]=t})),e)),{});let ee=new AbortController,te=!0;function ne(e){e=e||document,Array.from(e.querySelectorAll(X)).forEach((e=>{e.disabled=!0}))}function ae(e,t){(e=e||document).querySelector(".tec-tickets-seating__ticket-rows").innerHTML="",t.forEach((t=>{!function(e,t){var n,a,o;e=e||document;const s=null!==(n=Z?.[t.ticketId]?.priceValue)&&void 0!==n?n:null,i=null!==(a=Z?.[t.ticketId]?.price)&&void 0!==a?a:null,c=null!==(o=Z?.[t.ticketId]?.name)&&void 0!==o?o:null;if(null===s||null===c)return;const r={seatTypeId:t.seatTypeId,ticketId:t.ticketId,price:s,color:t.seatColor,ticketName:c,seatLabel:t.seatLabel,formattedPrice:i};e.querySelector(".tec-tickets-seating__ticket-rows").appendChild(function(e){return(0,P.createHtmlComponentFromTemplateString)('<div class="tec-tickets-seating__ticket-row"\n\t\t\tdata-seat-type-id="{seatTypeId}"\n\t\t\tdata-ticket-id="{ticketId}"\n\t\t\tdata-price="{price}"\n\t\t\tdata-seat-label="{seatLabel}"\n\t\t\t>\n\t\t\t<div class="tec-tickets-seating__seat-color" style="background: {color}"></div>\n\n\t\t\t<div class="tec-tickets-seating__label">\n\t\t\t\t<div class="tec-tickets-seating__ticket-name">{ticketName}</div>\n\t\t\t\t<div class="tec-tickets-seating__seat-label">{seatLabel}</div>\n\t\t\t</div>\n\n\t\t\t<div class="tec-tickets-seating__ticket-price">{formattedPrice}</div>\n\t\t</div>',e)}(r))}(e,t)})),async function(e){await ee.abort("New reservations data");const t=new AbortController,n=new URL(F);n.searchParams.set("_ajax_nonce",B),n.searchParams.set("action",W),n.searchParams.set("postId",$);let a=null;a=await fetch(n.toString(),{method:"POST",signal:t.signal,body:JSON.stringify({token:S(),reservations:e})}),ee=t,a.ok||console.error("Failed to post reservations to backend")}(t.reduce(((e,t)=>(e[t.ticketId]=e[t.ticketId]||[],e[t.ticketId].push({reservationId:t.reservationId,seatTypeId:t.seatTypeId,seatLabel:t.seatLabel}),e)),{})),function(e){e=e||document;const t=Array.from(e.querySelectorAll(".tec-tickets-seating__ticket-row"));var n;t.length?function(e){e=e||document,Array.from(e.querySelectorAll(X)).forEach((e=>{e.disabled=!1}))}(e):ne(e),z.innerText=(0,D.formatWithCurrency)(t.reduce((function(e,t){return e+Number(t.dataset.price)}),0)),Q.innerText=1===(n=t.length)?V.oneTicket:V.multipleTickets.replace("{count}",n);const a=e.querySelector(".tec-tickets-seating__total");0===t.length?a.classList.add("tec-tickets-seating__total-hidden"):a.classList.remove("tec-tickets-seating__total-hidden")}(e)}async function oe(e){const t=function(e){return(e=e||document).querySelector(".tec-tickets-seating__iframe-container iframe")}(e=e||document);if(!t)return console.error("Iframe element not found."),!1;!function(e){E(l,(()=>{b(l),I(e,u,H)})),E(_,(t=>{ae(e.closest(".event-tickets"),t.filter((e=>function(e){return e.seatTypeId&&e.ticketId&&e.seatColor&&e.seatLabel&&e.reservationId}(e)))),t.length?K.classList.add("tec-tickets-seating__empty-tickets-message-hidden"):K.classList.remove("tec-tickets-seating__empty-tickets-message-hidden")}))}(t);try{await async function(e){return await C(e),e}(t)}catch(e){return window.location.reload(),!1}!function(e){(e=e||document).querySelector(".tec-tickets-seating__sidebar-arrow").addEventListener("click",(()=>{const t=e.querySelector(".tec-tickets-seating__modal-sidebar");t&&t.classList.toggle("tec-tickets-seating__modal-sidebar-open")}))}(e),function(e){if(e=e||document,window&&window.innerWidth<=960){const t=e.querySelector(".tec-tickets-seating__iframe-container");t.style.height=t.clientHeight+"px",t.style.maxHeight=t.clientHeight+"px";const n=e.querySelector(".tec-tickets-seating__modal-sidebar_container");n.style.height=n.clientHeight+"px",n.style.minHeight=n.clientHeight+"px",n.style.maxHeight=n.clientHeight+"px";const a=n.querySelector(".tec-tickets-seating__modal-sidebar");a&&(a.style.position="absolute")}}(e),z=e.querySelector(".tec-tickets-seating__total-price"),Q=e.querySelector(".tec-tickets-seating__total-text"),K=e.querySelector(".tec-tickets-seating__empty-tickets-message")}async function se(e){if(!te)return;const t=e?e.querySelector(".tec-tickets-seating__iframe-container iframe.tec-tickets-seating__iframe"):null;t&&I(t,y),await async function(){await ee.abort("New reservations data");const e=new AbortController,t=new URL(F);t.searchParams.set("_ajax_nonce",B),t.searchParams.set("action",J),t.searchParams.set("token",S()),t.searchParams.set("postId",$);const n=await fetch(t.toString(),{signal:e.signal,method:"POST"});return ee=e,!!n.ok||(console.error("Failed to remove reservations from backend"),!1)}(),(0,U.reset)(),Array.from(document.querySelectorAll(".tec-tickets-seating__ticket-rows .tec-tickets-seating__ticket-row")).forEach((e=>{e.remove()}))}function ie(){const e=window?.[M];e&&e._hide()}async function ce(){te=!1;const e=function(e){let t;switch(e){case"TECTicketsCommerceModule":case"TEC\\Tickets\\Commerce\\Module":t=j;break;default:t=null}return t=(0,R.applyFilters)("tec.tickets.seating.checkoutHandler",t,e),t}(Y);if(!e)return void console.error(`No checkout handler found for provider ${Y}`);const t=new FormData;t.append("provider",Y),t.append("attendee[optout]","1"),t.append("tickets_tickets_ar","1");const n=function(){const e=Array.from(document.querySelectorAll(".tec-tickets-seating__ticket-rows .tec-tickets-seating__ticket-row")).reduce(((e,t)=>{const n=t.dataset.ticketId;return e?.[n]?(e[n].quantity++,e[n].seat_labels=[...e[n].seat_labels,t.dataset.seatLabel]):e[n]={ticket_id:n,quantity:1,optout:"1",seat_labels:[t.dataset.seatLabel]},e}),{});return Object.values(e)}();t.append("tribe_tickets_saving_attendees","1"),t.append("tribe_tickets_ar_data",JSON.stringify({tribe_tickets_tickets:n,tribe_tickets_meta:[],tribe_tickets_post_id:$})),await e(t)||console.error("Failed to proceed to checkout."),te=!0}function re(e){const t=e?e?.node?.querySelector(".tec-tickets-seating__iframe-container iframe.tec-tickets-seating__iframe"):null;if(!t)return;const n=G?Number(G):900;t.src=t.src+"&expireDate="+(Date.now()+1e3*n)}function le(){document.querySelector(".tec-tickets-seating__modal .tec-tickets-seating__sidebar-control--cancel")?.addEventListener("click",ie),document.querySelector(X)?.addEventListener("click",ce),(0,U.start)();const e=window[M];e&&(e.on("hide",se),e.on("destroy",se))}(async function(){return new Promise((e=>{const t=()=>{window[M]?e(window[M]):setTimeout(t,50)};t()}))})().then((e=>{e.on("show",(()=>{ne(),oe(document),le(),re(e)}))}))}},n={};function a(e){var o=n[e];if(void 0!==o)return o.exports;var s=n[e]={exports:{}};return t[e](s,s.exports,a),s.exports}a.m=t,e=[],a.O=(t,n,o,s)=>{if(!n){var i=1/0;for(d=0;d<e.length;d++){for(var[n,o,s]=e[d],c=!0,r=0;r<n.length;r++)(!1&s||i>=s)&&Object.keys(a.O).every((e=>a.O[e](n[r])))?n.splice(r--,1):(c=!1,s<i&&(i=s));if(c){e.splice(d--,1);var l=o();void 0!==l&&(t=l)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[n,o,s]},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={1490:0,4193:0,7018:0,7244:0,808:0};a.O.j=t=>0===e[t];var t=(t,n)=>{var o,s,[i,c,r]=n,l=0;if(i.some((t=>0!==e[t]))){for(o in c)a.o(c,o)&&(a.m[o]=c[o]);if(r)var d=r(a)}for(t&&t(n);l<i.length;l++)s=i[l],a.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return a.O(d)},n=globalThis.webpackChunkevent_tickets=globalThis.webpackChunkevent_tickets||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var o=a.O(void 0,[808],(()=>a("QiLJ")));o=a.O(o),window.tec=window.tec||{},window.tec.tickets=window.tec.tickets||{},window.tec.tickets.seating=window.tec.tickets.seating||{},window.tec.tickets.seating.frontend=window.tec.tickets.seating.frontend||{},window.tec.tickets.seating.frontend.ticketsBlock=o})();